"use strict";var t={},e={para:{name:"sensors",server_url:"",send_timeout:1e3,use_client_time:!1,show_log:!1,allow_amend_share_path:!0,max_string_length:500,datasend_timeout:3e3,source_channel:[],autoTrack:{appLaunch:!0,appShow:!0,appHide:!0},is_persistent_save:!1}},r="object"==typeof r?r:{};r.info=function(){if(e.para.show_log)return console.log.apply(console,arguments)},e.setPara=function(n){e.para=t.extend2Lev(e.para,n),GameGlobal[e.para.name]=e;var i=[];if(t.isArray(e.para.source_channel))for(var s=e.para.source_channel.length,a=0;a<s;a++)-1===" utm_source utm_medium utm_campaign utm_content utm_term sa_utm ".indexOf(" "+e.para.source_channel[a]+" ")&&i.push(e.para.source_channel[a]);e.para.source_channel=i,t.isObject(e.para.register)&&t.extend(t.info.properties,e.para.register),e.para.openid_url||(e.para.openid_url=e.para.server_url.replace(/([^\/])\/(sa)(\.gif){0,1}/,"$1/mp_login")),"number"!=typeof e.para.send_timeout&&(e.para.send_timeout=1e3);var o={send_timeout:6e3,max_length:6};!0===e.para.batch_send?(e.para.batch_send=t.extend({},o),e.para.use_client_time=!0):"object"==typeof e.para.batch_send&&(e.para.use_client_time=!0,e.para.batch_send=t.extend({},o,e.para.batch_send)),e.para.server_url||r.info("请使用 setPara() 方法设置 server_url 数据接收地址,详情可查看https://www.sensorsdata.cn/manual/mp_sdk_new.html#112-%E5%BC%95%E5%85%A5%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0")},e.status={};var n=Array.prototype,i=Object.prototype,s=n.slice,a=i.toString,o=i.hasOwnProperty,c=["$latest_utm_source","$latest_utm_medium","$latest_utm_campaign","$latest_utm_content","$latest_utm_term","latest_sa_utm"];e.status.referrer="直接打开";var u,p,f,d,l,h=null,_=0,m="",g=!1;e.lib_version="0.6.1",u=n.forEach,p=n.indexOf,f=Array.isArray,d={},l=t.each=function(t,e,r){if(null==t)return!1;if(u&&t.forEach===u)t.forEach(e,r);else if(t.length===+t.length){for(var n=0,i=t.length;n<i;n++)if(n in t&&e.call(r,t[n],n,t)===d)return!1}else for(var s in t)if(o.call(t,s)&&e.call(r,t[s],s,t)===d)return!1},t.logger=r,t.extend=function(t){return l(s.call(arguments,1),(function(e){for(var r in e)void 0!==e[r]&&(t[r]=e[r])})),t},t.extend2Lev=function(e){return l(s.call(arguments,1),(function(r){for(var n in r)void 0!==r[n]&&(t.isObject(r[n])&&t.isObject(e[n])?t.extend(e[n],r[n]):e[n]=r[n])})),e},t.coverExtend=function(t){return l(s.call(arguments,1),(function(e){for(var r in e)void 0!==e[r]&&void 0===t[r]&&(t[r]=e[r])})),t},t.isArray=f||function(t){return"[object Array]"===a.call(t)},t.isFunction=function(t){try{return/^\s*\bfunction\b/.test(t)}catch(t){return!1}},t.isArguments=function(t){return!(!t||!o.call(t,"callee"))},t.toArray=function(e){return e?e.toArray?e.toArray():t.isArray(e)||t.isArguments(e)?s.call(e):t.values(e):[]},t.values=function(t){var e=[];return null==t||l(t,(function(t){e[e.length]=t})),e},t.include=function(t,e){var r=!1;return null==t?r:p&&t.indexOf===p?-1!=t.indexOf(e):(l(t,(function(t){if(r||(r=t===e))return d})),r)},t.isObject=function(t){return null!=t&&"[object Object]"==a.call(t)},t.isEmptyObject=function(e){if(t.isObject(e)){for(var r in e)if(o.call(e,r))return!1;return!0}return!1},t.isUndefined=function(t){return void 0===t},t.isString=function(t){return"[object String]"==a.call(t)},t.isDate=function(t){return"[object Date]"==a.call(t)},t.isBoolean=function(t){return"[object Boolean]"==a.call(t)},t.isNumber=function(t){return"[object Number]"==a.call(t)&&/[\d\.]+/.test(String(t))},t.isJSONString=function(t){try{JSON.parse(t)}catch(t){return!1}return!0},t.decodeURIComponent=function(t){var e="";try{e=decodeURIComponent(t)}catch(r){e=t}return e},t.encodeDates=function(e){return t.each(e,(function(r,n){t.isDate(r)?e[n]=t.formatDate(r):t.isObject(r)&&(e[n]=t.encodeDates(r))})),e},t.formatDate=function(t){function e(t){return t<10?"0"+t:t}return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+"."+e(t.getMilliseconds())},t.searchObjDate=function(e){t.isObject(e)&&t.each(e,(function(r,n){t.isObject(r)?t.searchObjDate(e[n]):t.isDate(r)&&(e[n]=t.formatDate(r))}))},t.formatString=function(t){return t.length>e.para.max_string_length?(r.info("字符串长度超过限制，已经做截取--"+t),t.slice(0,e.para.max_string_length)):t},t.searchObjString=function(e){t.isObject(e)&&t.each(e,(function(r,n){t.isObject(r)?t.searchObjString(e[n]):t.isString(r)&&(e[n]=t.formatString(r))}))},t.unique=function(t){for(var e,r=[],n={},i=0;i<t.length;i++)(e=t[i])in n||(n[e]=!0,r.push(e));return r},t.strip_sa_properties=function(e){return t.isObject(e)?(t.each(e,(function(n,i){if(t.isArray(n)){var s=[];t.each(n,(function(e){t.isString(e)?s.push(e):r.info("您的数据-",n,"的数组里的值必须是字符串,已经将其删除")})),0!==s.length?e[i]=s:(delete e[i],r.info("已经删除空的数组"))}t.isString(n)||t.isNumber(n)||t.isDate(n)||t.isBoolean(n)||t.isArray(n)||(r.info("您的数据-",n,"-格式不满足要求，我们已经将其删除"),delete e[i])})),e):e},t.strip_empty_properties=function(e){var r={};return t.each(e,(function(t,e){null!=t&&(r[e]=t)})),r},t.utf8Encode=function(t){var e,r,n,i,s="";for(e=r=0,n=(t=(t+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,i=0;i<n;i++){var a=t.charCodeAt(i),o=null;a<128?r++:o=a>127&&a<2048?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),null!==o&&(r>e&&(s+=t.substring(e,r)),s+=o,e=r=i+1)}return r>e&&(s+=t.substring(e,t.length)),s},t.base64Encode=function(e){var r,n,i,s,a,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,u=0,p="",f=[];if(!e)return e;e=t.utf8Encode(e);do{r=(a=e.charCodeAt(c++)<<16|e.charCodeAt(c++)<<8|e.charCodeAt(c++))>>18&63,n=a>>12&63,i=a>>6&63,s=63&a,f[u++]=o.charAt(r)+o.charAt(n)+o.charAt(i)+o.charAt(s)}while(c<e.length);switch(p=f.join(""),e.length%3){case 1:p=p.slice(0,-2)+"==";break;case 2:p=p.slice(0,-1)+"="}return p},e.initialState={queue:[],isComplete:!1,systemIsComplete:!1,storeIsComplete:!1,checkIsComplete:function(){this.systemIsComplete&&this.storeIsComplete&&(this.isComplete=!0,this.queue.length>0&&(t.each(this.queue,(function(t){e[t[0]].apply(e,s.call(t[1]))})),this.queue=[]))}},t.getCustomUtmFromQuery=function(r,n,i,s){if(!t.isObject(r))return{};var a={};if(r.sa_utm)for(var o in r)"sa_utm"!==o?t.include(e.para.source_channel,o)&&(a[i+o]=r[o]):a[s+o]=r[o];else for(var o in r)-1===" utm_source utm_medium utm_campaign utm_content utm_term ".indexOf(" "+o+" ")?t.include(e.para.source_channel,o)&&(a[i+o]=r[o]):a[n+o]=r[o];return a},t.getObjFromQuery=function(e){var r=e.split("?"),n={};return r&&r[1]?(t.each(r[1].split("&"),(function(t){var e=t.split("=");e[0]&&e[1]&&(n[e[0]]=e[1])})),n):{}},t.setStorageSync=function(t,e){var n=function(){wx.setStorageSync(t,e)};try{n()}catch(t){r.info("set Storage fail --",t);try{n()}catch(t){r.info("set Storage fail again --",t)}}},t.getStorageSync=function(t){var e="";try{e=wx.getStorageSync(t)}catch(n){try{e=wx.getStorageSync(t)}catch(t){r.info("getStorage fail")}}return e},t.getMPScene=function(t){return"number"==typeof t||"string"==typeof t&&""!==t?t="wx-"+String(t):"未取到值"},t.getShareDepth=function(){if("number"==typeof _&&0!==_){var t=e.store.getDistinctId(),r=e.store.getFirstId();return!m||m!==t&&m!==r?_+1:_}return 1},t.setShareInfo=function(e,r){var n={};if(!(e&&t.isObject(e.query)&&e.query.sampshare))return{};if(n=t.decodeURIComponent(e.query.sampshare),!t.isJSONString(n))return{};var i=(n=JSON.parse(n)).d,s=n.i;"string"==typeof s?(r.$share_distinct_id=s,m=s):r.$share_distinct_id="取值异常","number"==typeof i?(r.$share_depth=i,_=i):r.$share_depth="-1"},t.getShareInfo=function(){return JSON.stringify({i:e.store.getDistinctId()||"取值异常",d:t.getShareDepth()})},t.detectOptionQuery=function(r){if(!r||!t.isObject(r.query))return{};var n,i,s,a,o={};return o.query=t.extend({},r.query),"string"==typeof o.query.scene&&(n=o.query,i=["utm_source","utm_content","utm_medium","utm_campaign","utm_term","sa_utm"].concat(e.para.source_channel),s=new RegExp("("+i.join("|")+")%3D","i"),1===(a=Object.keys(n)).length&&"scene"===a[0]&&s.test(n.scene))&&(o.scene=o.query.scene,delete o.query.scene),r.query.q&&r.query.scancode_time&&"101"===String(r.scene).slice(0,3)&&(o.q=String(o.query.q),delete o.query.q,delete o.query.scancode_time),o},t.getMixedQuery=function(e){var r=t.detectOptionQuery(e),n=r.scene,i=r.q,s=r.query;for(var a in s)s[a]=t.decodeURIComponent(s[a]);return n&&(n=-1!==(n=t.decodeURIComponent(n)).indexOf("?")?"?"+n.replace(/\?/g,""):"?"+n,t.extend(s,t.getObjFromQuery(n))),i&&t.extend(s,t.getObjFromQuery(t.decodeURIComponent(i))),s},t.setUtm=function(e,r){var n={},i=t.getMixedQuery(e),s=t.getCustomUtmFromQuery(i,"$","_","$"),a=t.getCustomUtmFromQuery(i,"$latest_","_latest_","$latest_");return n.pre1=s,n.pre2=a,t.extend(r,s),n},t.wxrequest=function(r){var n=wx.request(r);setTimeout((function(){t.isObject(n)&&t.isFunction(n.abort)&&n.abort()}),e.para.datasend_timeout)},t.getIsFirstDay=function(){return"object"==typeof e.store._state&&"number"==typeof e.store._state.first_visit_day_time&&e.store._state.first_visit_day_time>(new Date).getTime()},t.info={currentProps:{},properties:{$lib:"MiniGame",$lib_version:String("0.6.1")},getSystem:function(){var r=this.properties;function n(){wx.getSystemInfo({success:function(t){var e,n;r.$manufacturer=t.brand,r.$model=t.model,r.$screen_width=Number(t.screenWidth),r.$screen_height=Number(t.screenHeight),r.$os=(e=t.platform,"ios"===(n=e.toLowerCase())?"iOS":"android"===n?"Android":e),r.$os_version=t.system.indexOf(" ")>-1?t.system.split(" ")[1]:t.system},complete:function(){var n=(new Date).getTimezoneOffset();e.para.appid&&(r.$app_id=e.para.appid),t.isNumber(n)&&(r.$timezone_offset=n),e.initialState.systemIsComplete=!0,e.initialState.checkIsComplete()}})}wx.getNetworkType({success:function(t){r.$network_type=t.networkType},complete:n})}},e._=t,e.prepareData=function(n,i){var s={distinct_id:this.store.getDistinctId(),lib:{$lib:"MiniGame",$lib_method:"code",$lib_version:String("0.6.1")},properties:{}};t.extend(s,n),t.isObject(n.properties)&&!t.isEmptyObject(n.properties)&&t.extend(s.properties,n.properties),n.type&&"profile"===n.type.slice(0,7)||(s._track_id=Number(String(Math.random()).slice(2,5)+String(Math.random()).slice(2,4)+String(Date.now()).slice(-4)),s.properties=t.extend({},t.info.properties,e.store.getProps(),t.info.currentProps,s.properties),s.properties.$is_first_day=t.getIsFirstDay()),s.properties.$time&&t.isDate(s.properties.$time)?(s.time=1*s.properties.$time,delete s.properties.$time):s.time=1*new Date,t.searchObjDate(s),t.searchObjString(s),r.info(s),e.sendStrategy.send(s)},e.store={verifyDistinctId:function(t){return"number"==typeof t&&(t=String(t),/^\d+$/.test(t)||(t="unexpected_id")),"string"==typeof t&&""!==t||(t="unexpected_id"),t},storageInfo:null,getUUID:function(){return Date.now()+"-"+Math.floor(1e7*Math.random())+"-"+Math.random().toString(16).replace(".","")+"-"+String(31242*Math.random()).replace(".","").slice(0,8)},getStorage:function(){return this.storageInfo||(this.storageInfo=e._.getStorageSync("sensorsdata2015_wechat")||""),this.storageInfo},_state:{},mem:{mdata:[],getLength:function(){return this.mdata.length},add:function(t){this.mdata.push(t)},clear:function(t){this.mdata.splice(0,t)}},toState:function(e){var r=null;t.isJSONString(e)?(r=JSON.parse(e)).distinct_id?this._state=r:this.set("distinct_id",this.getUUID()):t.isObject(e)&&(r=e).distinct_id?this._state=r:this.set("distinct_id",this.getUUID())},getFirstId:function(){return this._state._first_id||this._state.first_id},getDistinctId:function(){return this._state._distinct_id||this._state.distinct_id},getProps:function(){return this._state.props||{}},setProps:function(e,r){var n=this._state.props||{};r?this.set("props",e):(t.extend(n,e),this.set("props",n))},set:function(t,e){var r={};for(var n in"string"==typeof t?r[t]=e:"object"==typeof t&&(r=t),this._state=this._state||{},r)this._state[n]=r[n],"first_id"===n?delete this._state._first_id:"distinct_id"===n&&delete this._state._distinct_id;this.save()},change:function(t,e){this._state["_"+t]=e},save:function(){var t=JSON.parse(JSON.stringify(this._state));delete t._first_id,delete t._distinct_id,e._.setStorageSync("sensorsdata2015_wechat",t)},init:function(){var t=this.getStorage();if(t)this.toState(t);else{g=!0;var r=new Date,n=r.getTime();r.setHours(23),r.setMinutes(59),r.setSeconds(60),e.setOnceProfile({$first_visit_time:new Date}),this.set({distinct_id:this.getUUID(),first_visit_time:n,first_visit_day_time:r.getTime()})}}},e.setProfile=function(t,r){e.prepareData({type:"profile_set",properties:t},r)},e.setOnceProfile=function(t,r){e.prepareData({type:"profile_set_once",properties:t},r)},e.appendProfile=function(n,i){if(!t.isObject(n))return!1;t.each(n,(function(e,i){t.isString(e)?n[i]=[e]:t.isArray(e)||(delete n[i],r.info("appendProfile属性的值必须是字符串或者数组"))})),e.prepareData({type:"profile_append",properties:n},i)},e.incrementProfile=function(r,n){if(!t.isObject(r))return!1;var i=r;t.isString(r)&&((r={})[i]=1),e.prepareData({type:"profile_increment",properties:r},n)},e.track=function(t,e,r){this.prepareData({type:"track",event:t,properties:e},r)},e.identify=function(t,r){if("string"!=typeof t&&"number"!=typeof t)return!1;t=e.store.verifyDistinctId(t);var n=e.store.getFirstId();!0===r?n?e.store.set("first_id",t):e.store.set("distinct_id",t):n?e.store.change("first_id",t):e.store.change("distinct_id",t)},e.trackSignup=function(t,r,n,i){var s=e.store.getFirstId()||e.store.getDistinctId();e.store.set("distinct_id",t),e.prepareData({original_id:s,distinct_id:t,type:"track_signup",event:r,properties:n},i)},e.registerApp=function(e){t.isObject(e)&&!t.isEmptyObject(e)&&(t.info.currentProps=t.extend(t.info.currentProps,e))},e.register=function(r){t.isObject(r)&&!t.isEmptyObject(r)&&e.store.setProps(r)},e.clearAllRegister=function(){e.store.setProps({},!0)},e.clearAllProps=function(r){var n=e.store.getProps(),i={};t.isArray(r)&&(t.each(n,(function(e,n){t.include(r,n)||(i[n]=e)})),e.store.setProps(i,!0))},e.clearAppRegister=function(e){t.isArray(e)&&t.each(t.info.currentProps,(function(r,n){t.include(e,n)&&delete t.info.currentProps[n]}))},e.setLatestChannel=function(r){t.isEmptyObject(r)||(function(t,e){var r=!1;for(var n in e)t[e[n]]&&(r=!0);return r}(r,c)&&(e.clearAppRegister(c),e.clearAllProps(c)),e.para.is_persistent_save?e.register(r):e.registerApp(r))},e.login=function(t){if("string"!=typeof t&&"number"!=typeof t)return!1;t=e.store.verifyDistinctId(t);var r=e.store.getFirstId(),n=e.store.getDistinctId();t!==n&&(r||e.store.set("first_id",n),e.trackSignup(t,"$SignUp"))},e.getAnonymousID=function(){if(!t.isEmptyObject(e.store._state))return e.store._state._first_id||e.store._state.first_id||e.store._state._distinct_id||e.store._state.distinct_id;r.info("请先初始化SDK")},e.openid={getRequest:function(r){wx.login({success:function(n){n.code&&e.para.appid&&e.para.openid_url?t.wxrequest({url:e.para.openid_url+"&code="+n.code+"&appid="+e.para.appid,method:"GET",complete:function(e){t.isObject(e)&&t.isObject(e.data)&&e.data.openid?r(e.data.openid):r()}}):r()}})},getWXStorage:function(){var r=e.store.getStorage();if(r&&t.isObject(r))return r.openid},getOpenid:function(t){if(!e.para.appid)return t(),!1;var r=this.getWXStorage();r?t(r):this.getRequest(t)}},e.initial=function(){this._.info.getSystem(),this.store.init()},e.init=function(t){if(!0===this.hasInit)return!1;this.hasInit=!0,e.para.batch_send&&e.sendStrategy.batchInterval(),e.initialState.storeIsComplete=!0,e.initialState.checkIsComplete()},e.getPresetProperties=function(){if(t.info&&t.info.properties&&t.info.properties.$lib){var r={};t.each(t.info.currentProps,(function(t,e){0===e.indexOf("$")&&(r[e]=t)}));var n=t.extend(r,{$is_first_day:t.getIsFirstDay()},t.info.properties,e.store.getProps());return delete n.$lib,n}return{}},t.autoExeQueue=function(){return{items:[],enqueue:function(t){this.items.push(t),this.start()},dequeue:function(){return this.items.shift()},getCurrentItem:function(){return this.items[0]},isRun:!1,start:function(){this.items.length>0&&!this.isRun&&(this.isRun=!0,this.getCurrentItem().start())},close:function(){this.dequeue(),this.isRun=!1,this.start()}}},e.requestQueue=function(t){this.url=t.url},e.requestQueue.prototype.isEnd=function(){this.received||(this.received=!0,this.close())},e.requestQueue.prototype.start=function(){var r=this;setTimeout((function(){r.isEnd()}),e.para.send_timeout),t.wxrequest({url:this.url,method:"GET",complete:function(){r.isEnd()}})},e.dataQueue=t.autoExeQueue(),e.sendStrategy={dataHasSend:!0,dataHasChange:!1,onAppHide:function(){e.para.batch_send&&this.batchSend()},send:function(t){if(!e.para.server_url)return!1;if(e.para.batch_send){if(this.dataHasChange=!0,e.store.mem.getLength()>=300)return r.info("数据量存储过大，有异常"),!1;e.store.mem.add(t),e.store.mem.getLength()>=e.para.batch_send.max_length&&this.batchSend()}else this.queueSend(t)},queueSend:function(r){r._flush_time=Date.now(),r=JSON.stringify(r),r=-1!==e.para.server_url.indexOf("?")?e.para.server_url+"&data="+encodeURIComponent(t.base64Encode(r)):e.para.server_url+"?data="+encodeURIComponent(t.base64Encode(r));var n=new e.requestQueue({url:r});n.close=function(){e.dataQueue.close()},e.dataQueue.enqueue(n)},wxrequest:function(r){if(t.isArray(r.data)&&r.data.length>0){var n=Date.now();r.data.forEach((function(t){t._flush_time=n})),r.data=JSON.stringify(r.data),t.wxrequest({url:e.para.server_url,method:"POST",dataType:"text",data:"data_list="+encodeURIComponent(t.base64Encode(r.data)),success:function(){r.success(r.len)}})}else r.success(r.len)},batchSend:function(){if(this.dataHasSend){var t=e.store.mem.mdata,r=t.length;r>0&&(this.dataHasSend=!1,this.wxrequest({data:t,len:r,success:this.batchRemove.bind(this)}))}},batchRemove:function(t){e.store.mem.clear(t),this.dataHasSend=!0,this.dataHasChange=!0,this.batchWrite()},is_first_batch_write:!0,batchWrite:function(){var t=this;this.dataHasChange&&(this.is_first_batch_write&&(this.is_first_batch_write=!1,setTimeout((function(){t.batchSend()}),1e3)),this.dataHasChange=!1,e._.setStorageSync("sensors_mp_prepare_data",e.store.mem.mdata))},batchInterval:function(){var t=this;!function e(){setTimeout((function(){t.batchWrite(),e()}),500)}(),function r(){setTimeout((function(){t.batchSend(),r()}),e.para.batch_send.send_timeout)}()}},e.setOpenid=function(t,r){e.store.set("openid",t),r?e.store.set("distinct_id",t):e.identify(t,!0)},e.initWithOpenid=function(r,n){(r=r||{}).appid&&(e.para.appid=r.appid),e.openid.getOpenid((function(i){i&&e.setOpenid(i,r.isCoverLogin),n&&t.isFunction(n)&&n(i),e.init(r)}))},t.each(["login","setProfile","setOnceProfile","track","quick","incrementProfile","appendProfile"],(function(t){var r=e[t];e[t]=function(){e.initialState.isComplete?r.apply(e,arguments):e.initialState.queue.push([t,arguments])}})),t.setQuery=function(e,r){if(e&&t.isObject(e)&&!t.isEmptyObject(e)){var n=[];return t.each(e,(function(e,i){"q"===i&&t.isString(e)&&0===e.indexOf("http")||"scene"===i||(r?n.push(i+"="+e):n.push(i+"="+t.decodeURIComponent(e)))})),n.join("&")}return""},e.autoTrackCustom={trackCustom:function(r,n,i){var s=e.para.autoTrack[r],a="";e.para.autoTrack&&s&&("function"==typeof s?(a=s(),t.isObject(a)&&t.extend(n,a)):t.isObject(s)&&(t.extend(n,s),e.para.autoTrack[r]=!0),e.track(i,n))},appLaunch:function(r,n){"object"!=typeof this||this.trackCustom||(this[e.para.name]=e);var i={};t.setShareInfo(r,i);var s=t.setUtm(r,i);g?(i.$is_first_time=!0,t.isEmptyObject(s.pre1)||e.setOnceProfile(s.pre1)):i.$is_first_time=!1,e.setLatestChannel(s.pre2),i.$scene=t.getMPScene(r.scene),e.registerApp({$latest_scene:i.$scene}),i.$url_query=t.setQuery(r.query),n?(i=t.extend(i,n),e.track("$MPLaunch",i)):e.para.autoTrack&&e.para.autoTrack.appLaunch&&e.autoTrackCustom.trackCustom("appLaunch",i,"$MPLaunch"),g=!1},appShow:function(r,n){var i={};h=(new Date).getTime(),t.setShareInfo(r,i);var s=t.setUtm(r,i);e.setLatestChannel(s.pre2),i.$scene=t.getMPScene(r.scene),e.registerApp({$latest_scene:i.$scene}),i.$url_query=t.setQuery(r.query),e.autoTrackCustom.trackCustom("appShow",i,"$MPShow")},appHide:function(t){var r=(new Date).getTime(),n={};h&&r-h>0&&(r-h)/36e5<24&&(n.event_duration=(r-h)/1e3),e.autoTrackCustom.trackCustom("appHide",n,"$MPHide"),e.sendStrategy.onAppHide()}},e.quick=function(){var n=arguments[0],i=arguments[1],s=arguments[2],a=t.isObject(s)?s:{};if("getAnonymousID"===n){if(!t.isEmptyObject(e.store._state))return e.store._state._first_id||e.store._state.first_id||e.store._state._distinct_id||e.store._state.distinct_id;r.info("请先初始化SDK")}else"appLaunch"===n||"appShow"===n?i?e.autoTrackCustom[n](i,a):r.info("App的launch和show，在sensors.quick第二个参数必须传入App的options参数"):"appHide"===n&&(a=t.isObject(i)?i:{},e.autoTrackCustom[n](a))};const y=(b=!1,function(){b||(b=!0,e.para.autoTrack&&e.para.autoTrack.appLaunch&&e.quick("appLaunch",wx.getLaunchOptionsSync()))});var b;wx.onShow(t=>{y(),e.para.autoTrack&&e.para.autoTrack.appShow&&e.quick("appShow",t)}),wx.onHide(t=>{e.para.autoTrack&&e.para.autoTrack.appHide&&e.quick("appHide")}),e.onShareAppMessage=function(r){wx.onShareAppMessage((function(){if(e.track("$MPShare",{$share_depth:t.getShareDepth()}),"function"==typeof r){let n=r.call(wx);return e.para.allow_amend_share_path&&("object"!=typeof n&&(n={},n.query=""),n.query="string"==typeof n.query?n.query:"","object"==typeof n&&"string"==typeof n.query&&n.query&&"&"!==n.query.slice(-1)&&(n.query=n.query+"&"),n.query=n.query+"sampshare="+encodeURIComponent(t.getShareInfo())),n}}))},e.initial(),module.exports=e;
